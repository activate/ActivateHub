!!!
%html{:lang => "en"}
  %head
    %meta{:charset => "utf-8"}
      %title
        = "#{@page_title} Â» " if @page_title
        = SETTINGS.name
        \: #{SETTINGS.tagline}
      %meta{:content => "width=device-width, initial-scale=1.0, user-scalable=yes", :name => "viewport"}
      %meta{:content => "yes", :name => "apple-mobile-web-app-capable"}
      %meta{:content => "black", :name => "apple-mobile-web-app-status-bar-style"}
      %link{:href => "/opensearch.xml", :rel => "search", :title => SETTINGS.name, :type => "application/opensearchdescription+xml"}
      / Le HTML5 shim, for IE6-8 support of HTML elements
      /[if lt IE 9]
        %script{:src => "http://html5shim.googlecode.com/svn/trunk/html5.js"}
      / Stylesheets, static
      = stylesheet_link_tag 'common', :media => :all
      = theme_stylesheet_link_tag 'chosen', 'formtastic-bootstrap', 'layout', 'forms', 'jquery-ui-bootstrap/jquery-ui-bootstrap', :media => :all
      = theme_stylesheet_link_tag 'mobile', :media => mobile_stylesheet_media("only screen and (max-device-width: 960px)")
      /[if IE]
        = theme_stylesheet_link_tag 'ie', :media => :all
      = theme_stylesheet_link_tag 'print', :media => :print
      / Stylesheets, inserted
      = yield :css_insert
      %link{:charset => "utf-8", :href => "/less/site.less", :rel => "stylesheet/less", :type => "text/css"}/
      / JavaScripts, static
      = javascript_include_tag  "less"
      = javascript_include_tag  :defaults, :cache => true
      = theme_javascript_include_tag  'chosen.jquery'
      / JavaScripts, inserted
      = yield :javascript_insert
      / Auto-discovery, static
      = auto_discovery_link_tag(:atom, events_url(:format => 'atom'), :title => 'Atom: All Events' )
      / Auto-discovery, inserted
      = yield :discovery_insert
      %link{:href => "/images/site-icon.png", :rel => "apple-touch-icon"}/
  %body{:class => "#{"#{controller.controller_name}_#{action_name}"} #{"#{controller.controller_name}_controller"} #{%w[new create edit update].include?(action_name) ? "#{controller.controller_name}_change" : ""}"}
    .topbar
      .topbar-inner
        .container-fluid
          %a.brand{:href => "/", :title => SETTINGS.name}= theme_image_tag 'logo_dark_sm.png'
          %ul.nav
            %li{:class => link_class[:events]}= link_to "Events", events_path
            %li{:class => link_class[:organizations]}= link_to "Organizations", organizations_path
            %li{:class => link_class[:venues]}= link_to "Venues", venues_path
          .pull-right
            = form_tag '/events/search', :method => :get do
              #search_form
                - if request.env["HTTP_USER_AGENT"] && request.env["HTTP_USER_AGENT"].include?("Safari")
                  %input#search_field{:name => "query", :results => "5", :type => "search", :value => @query}
                - else
                  = text_field_tag 'query', @query, :id => 'search_field'
    .container-fluid
      .sidebar
        - if content_for?(:sidebar)
          = yield :sidebar
        .subnav.box
          -# Pick a subnav
          = render(:partial => 'events/subnav') if link_class[:events] == 'active'
          = render(:partial => 'venues/subnav') if link_class[:venues] == 'active'
          = render(:partial => 'sources/subnav') if link_class[:import] == 'active'
          = render(:partial => 'organizations/subnav') if link_class[:organizations] == 'active'
      .content
        - if content_for?(:breadcrumbs)
          %ul.breadcrumb
            %li
              %a{:href => "#"} Home
              %span.divider /
            = yield :breadcrumbs
        -# flash[:success] = "yay"; flash[:failure] = "meh <em>meh!</em>"; flash[:notice] = "note"; flash[:error] = "meh"; flash[:warn] = "look!"
        = render :partial => "shared/flash_messages.html", :locals => {:flash => flash}
        = yield
    :javascript 
      $(".chzn-select").chosen();
      $(".chzn-select-create").chosen({
        create_option: function(term){
          var chosen = this;
          chosen.append_option({
            value: term,
            text: term
          });
        },
        persistent_create_option: true
      });
    - if Rails.env == 'production'
      :javascript
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      :javascript
        var pageTracker = _gat._getTracker("UA-168427-7");
        pageTracker._initData();
        pageTracker._trackPageview();
